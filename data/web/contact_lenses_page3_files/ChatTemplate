(function(n){if(typeof define=="function"&&define.amd)define(["jquery"],n);else if(typeof module!="undefined"&&module.exports)module.exports=n;else n(jQuery,window,document,ChatTemplateResources||{Character:null,Avatar:{agent:null,robot:null,customer:null},Process:{onclick:!1,hyperlink:!1},Text:{helpful:"",unhelpful:""}})})(function(n,t,i,r){var o='<svg version="1.1" x="0px" y="0px" viewBox="0 0 20 20"><circle class="te_emojibg" cx="10" cy="10" r="9.1"><\/circle><g><circle class="te_helpfulemoji" cx="4.9" cy="7.7" r="1.1"><\/circle><path class="te_helpfulemoji" d="M10,0C4.5,0,0,4.5,0,10s4.5,10,10,10s10-4.5,10-10S15.5,0,10,0z M10,18.5c-4.7,0-8.5-3.8-8.5-8.5c0-4.7,3.8-8.5,8.5-8.5c4.7,0,8.5,3.8,8.5,8.5C18.5,14.7,14.7,18.5,10,18.5z"><\/path><path class="te_helpfulemoji" d="M10,10.3c-0.8,0-1.5-0.7-1.5-1.5H7c0,1.7,1.3,3,3,3s3-1.3,3-3h-1.5C11.5,9.6,10.8,10.3,10,10.3z"><\/path><circle class="te_helpfulemoji" cx="15.1" cy="7.7" r="1.1"><\/circle><\/g><\/svg>',s='<svg version="1.1" x="0px" y="0px" viewBox="0 0 20 20"><circle class="te_emojibg" cx="10" cy="10" r="9.1"><\/circle><g><path class="te_helpfulemoji" d="M10,0C4.5,0,0,4.5,0,10s4.5,10,10,10s10-4.5,10-10S15.5,0,10,0z M10,18.5c-4.7,0-8.5-3.8-8.5-8.5c0-4.7,3.8-8.5,8.5-8.5c4.7,0,8.5,3.8,8.5,8.5C18.5,14.7,14.7,18.5,10,18.5z"><\/path><ellipse class="te_helpfulemoji" cx="5.2" cy="7.6" rx="1.5" ry="0.6"><\/ellipse><polygon class="te_helpfulemoji" points="7.5,10.9 12.5,10.9 10,8.4  "><\/polygon><ellipse class="te_helpfulemoji" cx="14.8" cy="7.6" rx="1.5" ry="0.6"><\/ellipse><\/g><\/svg>';const h=function(n,t){if(/(\b(https?|ftp|file):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/ig.test(n)&&(r.Url.tecommondomain||"")!==""){let i="api/CrossURLDownload?url="+n+"&filename="+t;return r.Url.tecommondomain+i}return null},f=function(n,t){let e=null,u=null,f=!0;switch(n){case MessageType.TextMessage:case"TextMessage":e="text";u=t.strMessage;f=!0;break;case MessageType.OptionMessage:case"OptionMessage":e="text";u=JSON.parse(t.strMessage).caption;f=!0;break;case MessageType.ImageMessage:case"ImageMessage":if(e="image",f=!1,t.strMessage){let n=i.createElement("img");n.src=t.strMessage;u=n.outerHTML}else u='<canvas width="160" height="160"><\/canvas><div class="loading"><dfn class="loading_circle_s"><\/dfn><\/div>';break;case MessageType.VideoMessage:case"VideoMessage":if(e="video",f=!1,t.strMessage){let r=i.createElement("div"),n=i.createElement("video");n.controls=!0;let f=i.createElement("source");f.src=t.strMessage;f.type=t.ContentType;n.appendChild(f);let o=i.createTextNode("Your browser does not support the video tag.");n.appendChild(o);r.appendChild(n);let e=h(t.strMessage,t.FileName);if((e||"")!==""){let n=i.createElement("a");n.classList.add("download");n.classList.add("downloadUrl");n.href=e;n.download=t.FileName||"";let u=i.createElement("i");u.textContent="get_app";u.classList.add("material-icons");n.appendChild(u);r.appendChild(n)}u=r.innerHTML}else u='<canvas width="160" height="160"><\/canvas><div class="loading"><dfn class="loading_circle_s"><\/dfn><\/div>';break;case MessageType.DocumentMessage:case"DocumentMessage":if(e="Document",f=!1,t.strMessage){let n=i.createElement("div");n.classList.add("msg_text");let f=i.createElement("a");f.href=t.strMessage;let e=i.createElement("strong");e.appendChild(i.createTextNode(r.Text.Download));f.appendChild(e);f.target="_blank";let o=h(t.strMessage,t.FileName);if((o||"")!==""){let r=i.createElement("a");r.classList.add("downloadUrl");r.href=o;r.download=t.FileName||"";let u=i.createElement("i");u.textContent="get_app";u.classList.add("material-icons");r.appendChild(u);n.appendChild(r)}n.appendChild(f);u=n.outerHTML}else u='<dfn class="loading_circle_s"><\/dfn>',f=!0}return{Type:e,Content:u,bubble:f}};ToChatMsgObject=function(n,t,i){var e=null,u=n.Message,o;switch(n.strMessageType){case"BotMessage":case MessageType.BotMessage:o=u.MessageObject;o.type===BotSendType.text&&(e={chatID:u.strRobotChatID,source:"Service",ID:u.ChatDetailID,Character:u.Character==="Customer"||u.Character==="PassMenu"?"Customer":"Bot",Type:"text",Content:o.content,bubble:o.bubble,Posttime:u.dtmMessageTime,isMessageFeedback:u.isMessageFeedback,MessageFeedbackContent:u.MessageFeedbackContent});break;case"CustomerSendMessage":case MessageType.CustomerSendMessage:let t=f(u.strMessageType,u);e={source:"Client",ID:u.strChatDetailID,Character:"Customer",Type:t.Type,Content:t.Content,bubble:t.bubble};break;case"AgentSendMessage":case MessageType.AgentSendMessage:let i=f(u.strMessageType,u);e={source:"Client",ID:u.strChatDetailID,Character:u.strSender,Type:i.Type,Content:i.Content,bubble:i.bubble,Posttime:u.dtmMessageTime};break;case"SendChatMessage":case MessageType.SendChatMessage:u.ChatDetail&&(u=u.ChatDetail);let r=f(u.strMessageType,u);e={chatID:u.strChatID,source:"Service",ID:u.strChatDetailID,Character:u.strSender,Type:r.Type,Content:r.Content,bubble:r.bubble,Posttime:u.dtmMessageTime,SenderInfo:n.Message.SenderInfo}}return e&&r.Character&&(t===!0&&(e.ID=null),e.Content=e.Content||""),e.failed=i||!1,e};ChatTemplate=function(t){this.container=n(t)};ChatTemplate.prototype={firstgroup:function(){return n(".msgobject",this.container).first()},lastgroup:function(){return n(".msgobject",this.container).last()},newmessage:function(n){return a(n,this.container)},systemmessage:function(t,i,r){var u=n('<div class="dividers msgobject"/>'),f;r&&r.class&&Array.isArray(r.class)&&u.addClass(r.class.join(" "));switch(i){case"button":f=n('<input type="button" class="loadhistory">').val(t);u.addClass("load");u.append(f);break;default:case"text":u.text(t)}return u},appendSysTo:function(n,t,i,r){var u=this.systemmessage(n,t,r);i.length&&i.parent().length?u.insertAfter(i):this.container.append(u)},prependSysTo:function(n,t,i,r){var u=this.systemmessage(n,t,r);i.length&&i.parent().length?u.insertBefore(i):this.container.prepend(u)},appendTo:function(t,i){for(var f=i.prevAll(),e=this.newmessage(t),s,r,o;f.length&&!i.parent().length;)i=f.first(),f.splice(0,1);i.length&&i.parent().length?(s=c(e,i),r=null,Array.prototype.forEach.call(s.childNodes,function(t){var f=n(t).clone(),e;r?f.insertAfter(r):(i.replaceWith(f),r=f);e=n(".slider_wrap",f);e.length&&u(e)})):(this.container.append(e),o=n(".slider_wrap",e),o.length&&u(o))},prependTo:function(t,i){for(var s=i.nextAll(),r=this.newmessage(t),h,e,o,f;s.length&&!i.parent().length;)i=s.first(),s.splice(0,1);if(i.length&&i.parent().length)for(h=c(r,i,!1),e=null,o=h.childNodes.length-1;o>=0;o--)r=n(h.childNodes[o]).clone(),e?r.insertBefore(e):(i.replaceWith(r),e=r),f=n(".slider_wrap",r),f.length&&u(f);else this.container.prepend(r),f=n(".slider_wrap",r),f.length&&u(f)},setFeedbackDone:function(t,r,u){var f=i.createElement("div"),e,c,h;f.className="helpful result";f.innerHTML=r==="Helpful"?o:s;u&&(r==="Helpful"?(n(".emojiPopup>.pic .helpfulsvg").show(),n(".emojiPopup>.pic .unhelpsvg").hide()):(n(".emojiPopup>.pic .helpfulsvg").hide(),n(".emojiPopup>.pic .unhelpsvg").show()),e=n(".emojiPopup"),c=n(".basicframe"),e.show(),e.remove(),e.insertBefore(c));h=n(".msgbubble:last",t);n(".slider_wrap",h).length>0?n(".slider_wrap",h).append(f):h.append(f);n(">.helpful",t).remove()}};var l=function(n,t){var i,f,u;switch(n){case"Bot":f="agent";u=r.Avatar.robot;i="Bot";break;case"System":case"Agent":f="agent";u=r.Avatar.agent;i="Agent";r.Character==="Agent"&&(t?(u=t.strAgentAvatar,i=t.ID.toLowerCase()):i=viewdata.AgentID.toLowerCase());break;case"Customer":f="client";u=r.Avatar.customer;i="Customer"}return{character:i,side:f,avatar:u}},e=function(t){var i=n(".msgbubble",t);if(i.length){var r=n(".msgbubble[data-did]",t),u=n(".msgbubble[data-failed]",t),f=i.last().data("time");i.length>1?t.addClass("group"):t.removeClass("group");u.length?t.addClass("unsend"):(t.removeClass("unsend"),r.length?t.addClass("resend"):t.removeClass("resend"));n(".msgcontent .time",t).text(f)}else t.remove()},a=function(t,u){var y,g,w,b,k,d;t.ID&&(y=n('.msgbubble[data-did="'+t.ID+'"]',n(".msgobject",u)),y.length&&(g=y.parents(".msgobject"),y.remove(),e(g),t.ID=t.source==="Client"?t.ID:null));var h=n('<dl class="msg_wrap msgobject"><dd class="msgcontent"><\/dd><\/dl>'),p=n('<dt class="msgavatar"><img/><\/dt>'),f=n('<div class="msgbubble'+(t.bubble===!1?"":" msg_text")+'"/>'),nt=DateFormat(t.Posttime,"HH:mm:ss"),rt=n('<span class="time">').text(nt),c=l(t.Character,t.SenderInfo);if((t.ID&&t.source==="Client"?function(){f.get(0).setAttribute("data-did",t.ID)}:new Function)(),(t.failed&&t.source==="Client"?function(){f.get(0).setAttribute("data-failed",t.failed)}:new Function)(),f.data("time",nt),(t.chatID?function(){f.get(0).setAttribute("data-chatid",t.chatID)}:new Function)(),f.append(t.Content),h.get(0).setAttribute("data-side",c.side),h.addClass(c.side),c.avatar&&(n("img",p).get(0).src=c.avatar,p.get(0).setAttribute("data-character",c.character),h.prepend(p)),f.get(0).innerHTML=f.get(0).innerHTML.replace(/(\r?\n|\r)$/g,function(){var n=i.createElement("BR");return n.outerHTML+n.outerHTML}),f.get(0).innerHTML=f.get(0).innerHTML.replace(/\r?\n|\r/g,function(){var n=i.createElement("BR");return n.outerHTML}),r.Process.hyperlink&&(w=function(t){t.childNodes.length&&Array.prototype.forEach.call(t.childNodes,function(t){var r,u,f;t.nodeType===Node.TEXT_NODE&&n.trim(t.nodeValue)&&(r=/((?:https?|ftp|file):\/\/\S+)|(www.\S+)|(?:\b(?:[a-z]{2,}(?=\.)|\w{1}(?=\.)|\w{2,}\b)(?:\.\w{2,})+)(?:[\/?#]\S*)?/gi,u=n.trim(t.nodeValue),r.test(u)&&(f=i.createElement("SPAN"),f.innerHTML=u.replace(r,function(n){var t=i.createElement("A");return t.href=n,t.text=n,t.target="_blank",t.outerHTML}),t.parentNode.insertBefore(f,t),t.parentNode.removeChild(t)));t.nodeName!=="A"&&w(t)})},w(f.get(0))),b=function(t){t.childNodes.length&&Array.prototype.forEach.call(t.childNodes,function(t){var r,u,f;t.nodeType===Node.TEXT_NODE&&n.trim(t.nodeValue)&&(r=/([a-zA-Z0-9._-]+@\w+([\.-]?\w+)*(\.\w{2,})+)/ig,u=n.trim(t.nodeValue),r.test(u)&&(f=i.createElement("SPAN"),f.innerHTML=u.replace(r,function(n){var t=i.createElement("A");return t.href="mailto:"+n,t.text=n,t.outerHTML}),t.parentNode.insertBefore(f,t),t.parentNode.removeChild(t)));t.nodeName!=="A"&&b(t)})},b(f.get(0)),k=function(t){t.childNodes.length&&Array.prototype.forEach.call(t.childNodes,function(t){var r,u,f;t.nodeType===Node.TEXT_NODE&&n.trim(t.nodeValue)&&(r=/[\+]?[(]?[0-9]{2,}[)]?[-\.]?[0-9]{3,}[-\.]?[0-9]{0,}/igm,u=n.trim(t.nodeValue),r.test(u)&&(f=i.createElement("SPAN"),f.innerHTML=u.replace(r,function(n){var t=i.createElement("A");return t.href="tel:"+n,t.text=n,t.outerHTML}),t.parentNode.insertBefore(f,t),t.parentNode.removeChild(t)));t.nodeName!=="A"&&k(t)})},k(f.get(0)),r.Process.onclick&&n("[onclick]",f).each(function(n,t){var i=t.getAttribute("onclick");t.removeAttribute("onclick");t.setAttribute("data-onclick",i);t.classList.add("onclickelement");t.tagName==="A"&&(t.href="javascript:void(0);")}),t.Type.toLowerCase()==="text"&&(d=function(t){t.childNodes.length&&Array.prototype.forEach.call(t.childNodes,function(t){var r,u;t.nodeType===Node.TEXT_NODE&&n.trim(t.nodeValue)&&(r=ProcessEmoji(t.nodeValue),r!==t.nodeValue&&(u=i.createElement("SPAN"),u.innerHTML=r,t.parentNode.insertBefore(u,t),t.parentNode.removeChild(t)));d(t)})},d(f.get(0))),n(".msgcontent",h).append(f),n(".msgcontent",h).append(rt),t.isMessageFeedback&&!t.MessageFeedbackContent){var a=i.createElement("li"),v=i.createElement("li"),tt=n("<ul>"),it=n('<dd class="helpful feedback">');a.dataset.onclick="Feedback("+t.ID+"|Helpful)";a.className="comment";a.innerHTML=o;v.dataset.onclick="Feedback("+t.ID+"|Unhelp)";v.className="comment";v.innerHTML=s;n(a).append(n("<span>"+r.Text.helpful+"<\/span>"));n(v).append(n("<span>"+r.Text.unhelpful+"<\/span>"));tt.append(a).append(v);it.append(tt);h.append(it)}else t.isMessageFeedback&&ChatTemplate.prototype.setFeedbackDone(h,t.MessageFeedbackContent,!1);return h},c=function(t,r,u){var s=i.createDocumentFragment(),o=[],f;if(e(t),r.length)if(f=r.clone(),f.data("side",r.data("side")),n(".msgavatar",f).data("character",n(".msgavatar",r).data("character")),t.data("side")===r.data("side")&&(t.hasClass("unsend")&&f.hasClass("unsend")||!t.hasClass("unsend")&&!f.hasClass("unsend"))&&(t.hasClass("resend")&&f.hasClass("resend")||!t.hasClass("resend")&&!f.hasClass("resend"))&&n(".msgavatar",r).data("character")===n(".msgavatar",t).data("character")&&n(".msgbubble",t).hasClass("msg_text")&&n(".msgbubble",f).hasClass("msg_text")){var a=n(".msgcontent",f),h=n(".msgbubble",f),c=n(".msgbubble",t),l=n(".helpful.feedback",t),v=n(".helpful.result",t);u===!1?c.insertBefore(h.first()):c.insertAfter(h.last());l.length>0&&l.insertAfter(a);o.push(f)}else o.push(f),o.push(t);else o.push(t);return o.forEach(function(n){e(n);u===!1?s.insertBefore(n.get(0),s.childNodes[0]):s.appendChild(n.get(0))}),s},u=function(n){n.length&&n.sliderWrapProcess()};n.fn.sliderWrapProcess=function(){var t=n(this),u=n(".jcarouselslider",t);if(u.length)u.on("jcarousel:reload jcarousel:create",function(){var t=n(this),i=t.jcarousel("list"),r=t.jcarousel("items"),u=r.outerWidth(!0);i.css("width",Math.ceil(u*r.length)+"px");i.css("position","relative");n(this).jcarousel("scroll",0,!1)}).jcarousel({list:"ul.listcontentouter"}),n(".ar_prev",t).jcarouselControl({target:"-=1"}),n(".ar_next",t).jcarouselControl({target:"+=1"});else{var i=n(".slider",t),f=n("ul",i),e=n("li",f),r=e.outerWidth(!0)*e.length;f.width(r);r<i.width()&&i.width(r)}}})