var pageFun = {};
var wh = 0;
//抓網址參數
function getValue(vname){
  var url=window.location.toString(),
      str="",
      str_value="";
      if(url.indexOf("?")!=-1){
          var ary=url.split("?")[1].split("&");
          for(var i in ary){
              str=ary[i].split("=")[0];
              if (str == vname) {
                  str_value = decodeURI(ary[i].split("=")[1]);
                  return str_value;
              }
          }
      }
}
if(getValue("hide"))
{
	$("body").addClass('hideInfo');
}
$(function(){
	var headerH = $("#headerMain").height(),
			historTop = ($("#history").length)?$("#history").offset().top:0,
			$body = (window.opera) ? (document.compatMode == "CSS1Compat" ? $('html') : $('body')) : $('html,body');
	//全站共用
	pageFun.modalPop = function(id){
		$("#modals "+id).show();
		$("#modals").fadeIn();
	}
	pageFun.openos = function(){
		$('.te_ts_bubble.chatbtn').click();
	}
	pageFun.modalClose = function(callback){
		$("#modals").fadeOut(500,function(){
			(callback && typeof(callback) === "function") && callback();
			$("#modals >div").hide();
		});
	}
	pageFun.mobileFun = function(){
	  $(".cami_content >div").click(function(){
	  	$("#toolMenu").trigger('click')
	  });
	  $('#Promotions >ul >li').click(function(){
		if($(this).hasClass('on')){
			$(this).removeClass('on');
		}
		else{
			$('#Promotions >ul >li').removeClass('on');
			$(this).addClass('on');
		}

	  })
	  $(window).bind('scroll',function () {
	    if($(this).scrollTop() > wh)
	    {
	       $("#history").addClass("on");
	    }
	    else
	    {
	       $("#history").removeClass("on");
	    }
	  });
	  $("#navShopCart").click(function(){
	    ($("#menu").is(":checked"))&&($("#menu").attr("checked",false));
	    ($("#toolMenu").hasClass("on"))&&($("#toolMenu").trigger('click'));
	    var $ta = $(this).parent();
	    if($ta.hasClass('on'))
	    {
	      $ta.removeClass('on');
	      $("#wrapper").removeClass('on');
	    }
	    else
	    {
	      $ta.addClass('on');
	      $("#wrapper").addClass('on');
	    }
	  });
	  $("#menu").on('change',function(){
	    if($(this).is(":checked"))
	    {
	      $("#wrapper").addClass('on');
	      if($("#toolMenu").hasClass("on"))
	      {
	        $("#toolMenu").removeClass('on');
	        $('#headerTop > ul').removeClass('on');
	        $("#headerStatus,#headerSearch").hide();
	      }
	      var $ta = $("#navShopCart").parent();
	      ($ta.hasClass('on')) && ($ta.removeClass('on'));
	    }
	    else
	    {
	      $("#wrapper").removeClass('on');
	    }
	  })
	  $("#headerTop").append('<a id="toolMenu"><a>');
	  $("#toolMenu").click(function(){
	    ($("#menu").is(":checked"))&&($("#menu").attr("checked",false));
	    ($("#navShopCart").parent().hasClass("on"))&&($("#navShopCart").trigger('click'));
	    if($(this).hasClass('on'))
	    {
	      $(this).removeClass('on');
	      $('#headerTop > ul').removeClass('on');
	      $("#headerStatus,#headerSearch").hide();
	      $("#wrapper").removeClass('on');
	    }
	    else
	    {
	      $(this).addClass('on');
	      $('#headerTop > ul').addClass('on');
	      $("#headerStatus,#headerSearch").show();
	      $("#wrapper").addClass('on');
	    }
	  })
	  $("nav >ul >li").each(function(i,el){
	    var mobileTab = $("<p><span></span></p>");
	    $(this).find("ol li").each(function(i2,el2){
	      if(i2 == 0)
	      {
	        $(this).find("dt a").clone().addClass('on').appendTo(mobileTab);
	        $(this).addClass('on');
	      }
	      else
	      {
	        $(this).find("dt a").clone().appendTo(mobileTab);
	      }
	    });
	    // mobileTab.append('<span></span>');
	    $(this).find(">div").prepend(mobileTab);
	    $(this).find(">div p span").click(function(){
	      console.log($(this).parent().parent());
	      $(this).parent().parent().hide();
	    })
	    $(this).find(">div p a").click(function(){
	      var now = $(this).index()-1;
	      $(this).parent().find("a").removeClass('on');
	      $(this).addClass('on');
	      $(this).parent().next().find('li').removeClass('on');
	      $(this).parent().next().find('li:eq('+now+')').addClass('on');
	    })
	  });
	  $("nav > ul > li > div > p a").attr("href","javascript:void(0)");
	  $("nav >ul >li >a").click(function(e){
		  e.preventDefault();
		  var _this = $(this);
		  _this.parent().find(">div").show();
	    
	  });
	  //手機上移動地圖位置
	  if($("#storeMap").length)
	  {
	    var apta = $("#storeMap").parent().next();
	    $("#storeMap").appendTo(apta);
	  }
	  //熱門強檔活動
	  if($("#Promotions").length)
	  {
	    $("#Promotions h3").click(function(){
	      ($("#Promotions").hasClass('on')) ? $("#Promotions").removeClass('on') : $("#Promotions").addClass('on');
	    })
	  }
	  if($("#productMain").length && !$('.hideInfo').length)
	  {
	    $("#productTransport").insertBefore("#productPrice");
	    $("#productCoupaon").insertBefore("#productPrice");
	    $(".ProductBuy").appendTo("#productActions");
	  }
	}
	pageFun.globalFun = function(){
		if(!$('html.desktop').length)
		{
			$("nav > ul >li >a").attr("href","javascript:void(0)");
		}
		$(window).resize(function() {
			// console.log($(window).width());
			if($(window).width() > 1023 && $("header #headerMain nav > ul > li > div > p").length && !$('.hideInfo').length || $(window).width() < 1024 && !$("html.mobile").length && !$("header #headerMain nav > ul > li > div > p").length && !$("header.mini").length)
			{
				//window.location.reload();
			}
		});
		pageFun.globalFun.openCatelog = function(st,ed,_this){
			if($(_this).hasClass('open'))
			{
				$("#catelog dl").children().slice(st,ed).hide();
				$(_this).removeClass('open');
			}
			else
			{
				$("#catelog dl").children().slice(st,ed).show();
				$(_this).addClass('open');
			}
		}
		var cta = [];
		$("#catelog dl dt").each(function(){
			cta.push($(this).index());
		});
		cta.push($("#catelog dl").children().length);
		$.each(cta,function(i,el){

			if(i < cta.length-1 && (cta[i+1] - cta[i]) > 6)
			{
				$("#catelog dl").children().slice(cta[i]+6,cta[i+1]).hide();
				$("#catelog dl dt:eq("+i+")").addClass('noPadding').html('<a onclick="pageFun.globalFun.openCatelog('+(cta[i]+6)+','+(cta[i+1])+',this)">'+$("#catelog dl dt:eq("+i+")").text()+'</a>');
			}
		})

		$("#mask").click(function(){
			pageFun.modalClose();
		});
		wh = $(window).height();
		//捲動fixed
		if($(window).width() > 1009)
		{
				$(window).bind('scroll',function () {
					if($(this).scrollTop() > headerH && !$("#headerMain").hasClass("fixed"))
					{
						 $("#headerMain,#headerStatus").addClass("fixed");
						 $("#history").addClass("fixed");
					}
					else if($(this).scrollTop() < headerH && $("#headerMain").hasClass("fixed"))
					{
						 $("#headerMain,#headerStatus").removeClass("fixed");
						 $("#history").removeClass("fixed");
					}
				});
				$("#cami_patrol_tool").click(function(){
					setTimeout(function(){
						$("#cami_iframe_container").css({top:50,left:-500});
					},100)
				})
		}
		else
		{
			pageFun.mobileFun();
		}
		// 2022.7.18 商品頁不執行
		if ( $('#productMain').length == 0 ) {
			//數量加減
			$("button.less").click(function(){
				var min = 0;
				if ( ($("input#limit_min").length) && ($('input#qua').length > 0) ){
					min = parseInt($("input#limit_min").val());
				}
				// 退貨頁面用
				if ( $(this).val() ){
					min = parseInt($("input[name=return_num["+ $(this).val() +"]]").val());
				}
				var nowN = parseInt($(this).parent().find("input").val());
				if(nowN > 0 && (nowN-1 >= min) ){
					$(this).parent().find("input").val(nowN-1)
				}
			})
			$("button.plus").click(function(){
				var max = parseInt($("input#limit_max").val());
				if ( $("input#limit_max").length ){
					max = parseInt($("input#limit_max").val());
				}
				// 退貨頁面用
				if ( $(this).val() ){
					max = parseInt($("input[name=return_num["+ $(this).val() +"]]").val());
				}
				var nowN = parseInt($(this).parent().find("input").val());
				if(nowN >= 0 && (nowN+1 <= max) ){
					$(this).parent().find("input").val(nowN+1)
				}
			})
		}
		var $historySlide = $("#historySlide");
		if($historySlide.find('ul.slides li').length > 3)
		{
			var $itemH = $historySlide.find('ul.slides li').height(),
					nowPos = 0,
					maxPos = $historySlide.find('ul.slides li').length -3;
			$historySlide.find('.flex-direction-nav').show();
			$historySlide.find('.flex-nav-prev').click(function(){
				if(nowPos > 0)
				{
					nowPos -= 1;
					$historySlide.find('.flex-nav-next').show();
					if(nowPos == 0)
					{
						$historySlide.find('.flex-nav-prev').hide();
					}
					$historySlide.find('ul.slides').stop().animate({scrollTop: nowPos*$itemH}, 500);
				}
			})
			$historySlide.find('.flex-nav-next').click(function(){
				if(nowPos < maxPos )
				{
					nowPos += 1;
					$historySlide.find('.flex-nav-prev').show();
					if(nowPos == maxPos)
					{
					 $historySlide.find('.flex-nav-next').hide();
					}
					$historySlide.find('ul.slides').stop().animate({scrollTop: nowPos*$itemH}, 500);
				}
			})
		}
		$("#history a.open").click(function(){
			($("#history").hasClass("open"))?$("#history").removeClass("open"):$("#history").addClass("open");
		});
		$(".closePop").click(pageFun.modalClose);
		$("#history a.top").click(function(){
			$body.stop().animate({scrollTop: 0}, 1000);
		});
	};
	pageFun.productDetail = function(){
		// The slider being synced must be initialized first

		$('#photoThumb').flexslider({
			animation: "slide",
			controlNav: false,
			animationLoop: false,
			slideshow: false,
			itemWidth: 90,
			itemMargin: 5,
			asNavFor: '#bigPhoto'
		});
		$('#bigPhoto').flexslider({
			animation: "slide",
			controlNav: false,
			animationLoop: false,
			slideshow: false,
			sync: "#photoThumb",
			start: function(slider){
				if(getValue("hide"))
				{

			  		$("body.hideInfo #productDetail").show();
				}
			}
		});
		//加入購物車
		$("button.ProductBuy.buy.showpop").click(function(){
			pageFun.modalPop('#modalProductDetailBuy');
		});
		//檢查可用折價券
		$("#productCoupaon").click(function(){
			pageFun.modalPop('#modalCheckCoupon');
		});
		//切換產品資訊
		$("#productTab ul li").click(function(){
			var nowi = $(this).index();
			$("#productTab ul li").removeClass("on");
			$("#productTab ul li:eq("+nowi+")").addClass("on");
			$(".productTabcontent").hide();
			$(".productTabcontent:eq("+nowi+")").show();
		});
		//加入購物車動畫
		$(".modalAddCart").click(function(){
			// pageFun.modalClose(addToCart);
			pageFun.modalClose();
		});
		//計時器
		if($("#productTimer").length)
		{
			var finalData = $("#productTimer").data("date");
			$("#productTimer p")
				.countdown(finalData, function(event) {
					$(this).html(
						event.strftime('還有<span>%D</span>天<span>%H</span>時<span>%M</span>分<span>%S</span>秒')
					);
				});
		}
	}
	pageFun.shopCart = function(){
		$("#modalSelectCoupon input[name=useCoupon]").change(function(){
			$("#modalSelectCoupon label input").attr("disabled",true);
			$("#modalSelectCoupon li li input").attr("disabled",true);
			$("#modalSelectCoupon li ul").addClass("disabled");
			$(this).parent().find("input").removeAttr("disabled");
			$(this).parent().find("ul").removeClass("disabled");
			if($(this).attr("id") == "typeCoupon")
			{
				$(this).next().find("input").focus();
			}
		});
		// $("#modalSelectCouponBonus input[name=useCouponBonus]").change(function(){
		// 	$("#modalSelectCouponBonus label input").attr("disabled",true);
		// 	$("#modalSelectCouponBonus li li input").attr("disabled",true);
		// 	$("#modalSelectCouponBonus li ul").addClass("disabled");
		// 	$(this).parent().find("input").removeAttr("disabled");
		// 	$(this).parent().find("ul").removeClass("disabled");
		// 	if($(this).attr("id") == "typeCoupon")
		// 	{
		// 		$(this).next().find("input").focus();
		// 	}
		// });
		// $("#checkCoupon").click(function(){
		// 	$("dd.coupon").show();
		// 	$("#modals").fadeOut(500,function(){
		// 		$("#modals >div").hide();
		// 	});
		// });
		$("#checkPoint").click(function(){
			if ( parseInt($('input#modal_use_bonus').val()) ){
				$("dd.point").show();
			}else{
				$("dd.point").hide();
			}
			$("#modals").fadeOut(500,function(){
				$("#modals >div").hide();
			});
		});
		//使用折價券
		$("#useCoupon").click(function(){
		 pageFun.modalPop('#modalSelectCoupon');
		});
		//使用購物金
		$("#useCouponBonus").click(function(){
		 pageFun.modalPop('#modalSelectCouponBonus');
		});
		//使用點數
		$("#usePoint").click(function(){
		 pageFun.modalPop('#modalSelectPoint');
		});
		//搜尋門市
		/*
		$("#searchStore").click(function(){
			var nTemp_Store_Zip = parseInt($('#county').val());
			$.ajax({
				type: 'POST',
				url: '/ajax/ajax_search_store.php',
				dataType: 'html',
				data: 'store_zip=' + nTemp_Store_Zip,
				success: function (sMsg){
					if ( sMsg == 'error' )
					{
						alert('系統錯誤，請重新操作。');
					}else{
						sMsg = JSON.parse(sMsg);
						$('#storeSearchResultNum').text('(共' + sMsg.length + '筆)');
						$('#selectStore').empty();
						$('#selectStore').append('<option value="" disabled="" selected="">請選擇門市</option>');
						sMsg.forEach(function(e) {
							$('#selectStore').append('<option value="' + e.store_id + '" data-store=\''+ JSON.stringify(e) + '\'>' + e.store_name + '</option>');
						});
					}
				},
				error: function (sMsg1, sMsg2){
					alert('系統錯誤！');
				},
			});
			$("#storeSearchResult").show();
		});
		$("#selectStore").change(function(){
			var store = JSON.parse($("#selectStore option:selected").attr('data-store'));
			$('#storeSearchResultName').text(store.store_name);
			$('#storeSearchResultAddress').text(store.store_address + ' ' + store.store_phone);
			$('#storeSearchResultOpen').text('營業時間 ' + store.store_opentime);
			if(store.store_lat && store.store_lng){
				$('#storeMap iframe').attr('src', 'https://www.google.com/maps/embed/v1/place?key=AIzaSyCT0Nb4KWcWaQoV63tAJar5ATMfdaJF9lY&q=' + store.store_lat + ',' + store.store_lng);
			}else{
				$('#storeMap iframe').attr('src', 'https://www.google.com/maps/embed/v1/place?key=AIzaSyCT0Nb4KWcWaQoV63tAJar5ATMfdaJF9lY&q=' + store.store_address);
			}
			// $('#storeMap iframe').attr('src', 'https://www.google.com/maps/embed/v1/place?key=AIzaSyCT0Nb4KWcWaQoV63tAJar5ATMfdaJF9lY&q=' + store.store_lat + ',' + store.store_lng);
			$("#storeSearchResult dl,#storeMap").show();
			$("input[name=store_id]").val(store.store_id);
			$("input[name=store_id]").attr('data-store', JSON.stringify(store));
		})
		$("#oftenStores").change(function(){
			$("#storeSearchResult dl,#storeMap,#storeSearchResult").hide();
			var store = JSON.parse($("#oftenStores option:selected").attr('data-store'));
			$('#storeSearchResultName').text(store.store_name);
			$('#storeSearchResultAddress').text(store.store_address + ' ' + store.store_phone);
			$('#storeSearchResultOpen').text('營業時間 ' + store.store_opentime);
			if(store.store_lat && store.store_lng){
				$('#storeMap iframe').attr('src', 'https://www.google.com/maps/embed/v1/place?key=AIzaSyCT0Nb4KWcWaQoV63tAJar5ATMfdaJF9lY&q=' + store.store_lat + ',' + store.store_lng);
			}else{
				$('#storeMap iframe').attr('src', 'https://www.google.com/maps/embed/v1/place?key=AIzaSyCT0Nb4KWcWaQoV63tAJar5ATMfdaJF9lY&q=' + store.store_address);
			}
			// $('#storeMap iframe').attr('src', 'https://www.google.com/maps/embed/v1/place?key=AIzaSyCT0Nb4KWcWaQoV63tAJar5ATMfdaJF9lY&q=' + store.store_lat + ',' + store.store_lng);
			$("#storeSearchResult dl,#storeMap").show();
			$("input[name=store_id]:first").prop('checked', true);
			$("input[name=store_id]").val(store.store_id);
			$("input[name=store_id]").attr('data-store', JSON.stringify(store));
		})
		*/
		//搜尋門市
		$("#add2_select").change(function(){
			var nTemp_Store_Zip = parseInt($('#add2_select').val());
			var nLimit_Store_Ec = 1;
			var nLimit_Eye_Pay = 0;

			// 預約服務頁面 不限定 EC 門市，預約試戴有限定 EC 門市
			if ( $('input[name=experience_name]').length ){
				nLimit_Store_Ec = 0;
			}

			if ( cart_mode && (cart_mode == 4) ){
				nLimit_Eye_Pay = 1;
			}

			$.ajax({
				type: 'POST',
				url: '/ajax/ajax_search_store.php',
				dataType: 'html',
				data: 'store_zip=' + nTemp_Store_Zip + '&limit_store_ec=' + nLimit_Store_Ec + '&limit_eye_pay=' + nLimit_Eye_Pay,
				success: function (sMsg){
					if ( sMsg == 'error' )
					{
						alert('系統錯誤，請重新操作。');
					}else{
						sMsg = JSON.parse(sMsg);
						$('#storeSearchResultNum').text('(共' + sMsg.length + '筆)');
						$('#selectStore').empty();
						$('#selectStore').append('<option value="" disabled="" selected="">請選擇門市</option>');
						sMsg.forEach(function(e) {
							$('#selectStore').append('<option value="' + e.store_id + '" data-store=\''+ JSON.stringify(e) + '\'>' + e.store_name + '</option>');
						});
						$("ul.slectStore2 li h4,ul.slectStore2 li:first-child >div >h4 + p").addClass('on');
					}
				},
				error: function (sMsg1, sMsg2){
					alert('系統錯誤！');
				},
			});
		});
		$("#selectStore,#oftenStores").change(function(){
			var store = JSON.parse($(this).find("option:selected").attr('data-store'));

			if($("#storeTab1").is(":checked"))
			{
				$('#storeSearchResult dt >p').hide();
			}
			else
			{
				$('#storeSearchResult dt >p').show();
			}
			$('#storeSearchResultName').text(store.store_name);
			$('#storeSearchResultAddress').text(store.store_address + ' ' + store.store_phone);
			$('#storeSearchResultOpen').text('營業時間 ' + store.store_opentime);
			if(store.store_lat && store.store_lng){
				$('#storeMap iframe').attr('src', 'https://www.google.com/maps/embed/v1/place?key=AIzaSyCT0Nb4KWcWaQoV63tAJar5ATMfdaJF9lY&zoom=18&q=' + store.store_lat + ',' + store.store_lng);
			}else{
				$('#storeMap iframe').attr('src', 'https://www.google.com/maps/embed/v1/place?key=AIzaSyCT0Nb4KWcWaQoV63tAJar5ATMfdaJF9lY&zoom=18&q=' + store.store_address);
			}

			// $("input[name=store_id]:first").prop('checked', true);
			amego_store.set(store.store_id, JSON.stringify(store));
			if (store.store_time_list )
			{
				$('#bookingTime').empty();
				$('#bookingTime').append('<option value="" disabled="" selected="">請選擇時段</option>');
				store.store_time_list.forEach(function(e) {
					$('#bookingTime').append('<option value="' + e.value + '">' + e.name + '</option>');
				});
			}
			$("#storeSearchResult").addClass('on');

			if ( store.store_self_pay == 0 )
			{
				$('label[for=payByStore1]').parent().hide();
				// if ( $("input[name=payment][value=21]").prop('checked') )
				// {
				// 	$("input[name=payment][value=21]").prop('checked', false);
				// 	$(".transportStore input[type=radio]:first").prop('checked', true);
				// }
				if ( $("input#payByStore1").prop('checked') )
				{
					$("input#payByStore1").prop('checked', false);
					$(".transportStore input[type=radio]:first").prop('checked', true);
				}
			}
			else
			{
				$('label[for=payByStore1]').parent().show();
			}

			if ( store.store_nccc_pay == 0 )
			{
				$('label[for=payByStoreCredit1]').parent().hide();
				// if ( $("input[name=payment][value=21]").prop('checked') )
				// {
				// 	$("input[name=payment][value=21]").prop('checked', false);
				// 	$(".transportStore input[type=radio]:first").prop('checked', true);
				// }
				if ( $("input#payByStoreCredit1").prop('checked') )
				{
					$("input#payByStoreCredit1").prop('checked', false);
					$(".transportStore input[type=radio]:first").prop('checked', true);
				}
			}
			else
			{
				$('label[for=payByStoreCredit1]').parent().show();
			}

			if ( store.store_nccc3_pay == 0 )
			{
				$('label[for=payByStoreCredit2]').parent().hide();
				// if ( $("input[name=payment][value=21]").prop('checked') )
				// {
				// 	$("input[name=payment][value=21]").prop('checked', false);
				// 	$(".transportStore input[type=radio]:first").prop('checked', true);
				// }
				if ( $("input#payByStoreCredit2").prop('checked') )
				{
					$("input#payByStoreCredit2").prop('checked', false);
					$(".transportStore input[type=radio]:first").prop('checked', true);
				}
			}
			else
			{
				$('label[for=payByStoreCredit2]').parent().show();
			}

			if ( store.store_line_pay == 0 )
			{
				$('label[for=payByStoreLine]').parent().hide();
				// if ( $("input[name=payment][value=21]").prop('checked') )
				// {
				// 	$("input[name=payment][value=21]").prop('checked', false);
				// 	$(".transportStore input[type=radio]:first").prop('checked', true);
				// }
				if ( $("input#payByStoreLine").prop('checked') )
				{
					$("input#payByStoreLine").prop('checked', false);
					$(".transportStore input[type=radio]:first").prop('checked', true);
				}
			}
			else
			{
				$('label[for=payByStoreLine]').parent().show();
			}

			if ( store.store_jko_pay == 0 )
			{
				$('label[for=payByStoreJko]').parent().hide();
				// if ( $("input[name=payment][value=21]").prop('checked') )
				// {
				// 	$("input[name=payment][value=21]").prop('checked', false);
				// 	$(".transportStore input[type=radio]:first").prop('checked', true);
				// }
				if ( $("input#payByStoreJko").prop('checked') )
				{
					$("input#payByStoreJko").prop('checked', false);
					$(".transportStore input[type=radio]:first").prop('checked', true);
				}
			}
			else
			{
				$('label[for=payByStoreJko]').parent().show();
			}

			if ( store.store_eye_pay == 0 )
			{
				$('label[for=payByStoreEye]').parent().hide();
				// if ( $("input[name=payment][value=21]").prop('checked') )
				// {
				// 	$("input[name=payment][value=21]").prop('checked', false);
				// 	$(".transportStore input[type=radio]:first").prop('checked', true);
				// }
				if ( $("input#payByStoreEye").prop('checked') )
				{
					$("input#payByStoreEye").prop('checked', false);
					$(".transportStore input[type=radio]:first").prop('checked', true);
				}
			}
			else
			{
				$('label[for=payByStoreEye]').parent().show();
			}

			if ( store.store_pi_pay == 0 )
			{
				$('label[for=payByStorePi]').parent().hide();
				if ( $("input#payByStorePi").prop('checked') )
				{
					$("input#payByStorePi").prop('checked', false);
					$(".transportStore input[type=radio]:first").prop('checked', true);
				}
			}
			else
			{
				$('label[for=payByStorePi]').parent().show();
			}

			// 強制加入
			/*
			if ( store.store_code == '0792' )
			{
				$('label[for=payByStoreCredit1]').hide();
				$('label[for=payByStoreCredit2]').hide();
				if ( $("input#payByStoreCredit1").prop('checked') || $("input#payByStoreCredit2").prop('checked') )
				{
					$("input#payByStoreCredit1").prop('checked', false);
					$("input#payByStoreCredit2").prop('checked', false);
					$("input#payByStore1").prop('checked', true);
				}
			}
			else
			{
				$('label[for=payByStoreCredit1]').show();
				$('label[for=payByStoreCredit2]').show();
			}
			*/
		});
		$("input[name=storeTab]").change(function(){
			$("#storeSearchResult").removeClass('on');
			// $("input[name=store_id]:first").prop('checked', false);
			amego_store.clear();
			$("#selectStore,#oftenStores").val(null);


		});
		/*
		//切換付款模式
		$("input[name=delivery_mode]").change(function(){
			$("#storeSearchResult").removeClass('on');
			// $("input[name=store_id]:first").prop('checked', false);
			$("#selectStore,#oftenStores").val(null);
			$("#payWay >ul").hide();
			$("#payWay >ul."+$(this).attr("id")).show();
			($(this).attr("id") == "transportHome")?$(".onlySowinShop").show():$(".onlySowinShop").hide();
			($(this).attr("id") == "transportStore")?$("#shopFrom").hide():$("#shopFrom").show();
			if ( ($(this).attr("id") == "transportHome") || ($(this).attr("id") == "transportConvenient") || ($(this).attr("id") == "transportConvenientFamily")){
				amego_store.load();
			}
			else if($(this).attr("id") == "transportStore"){
				amego_store.save();
				amego_store.clear();
			}
			// $(".transportHome,transportConvenient,transportStore input[type=radio]").prop('checked', false);
			$("input[name=payment]").prop('checked', false);
			$("." + $(this).attr("id") + " input[type=radio]:first").prop('checked', true);
			// $('input[name=company_same]').toggle($('.onlySowinShop').css('display') !== 'none');
			$('label[name=company_same]').toggle($('.onlySowinShop').css('display') !== 'none');

			if ( ($(this).attr("id") == "transportHome") || ($(this).attr("id") == "transportConvenient") || ($(this).attr("id") == "transportConvenientFamily")){
				check_store_payment();
			}

			if ( $(this).attr("id") == "transportStore" ){
				$('#deductFreight').hide();
			} else {
				$('#deductFreight').show();
			}
		})
		*/
		// 常用地址
		$("#selectAddress").change(function(){
			var delivery = JSON.parse($("#selectAddress option:selected").attr('data-delivery'));
			$('input[name=delivery_name]').val(delivery.delivery_name);
			$('input[name=delivery_mobile]').val(delivery.delivery_mobile);
			$('input[name=delivery_phone]').val(delivery.delivery_phone);
			$('input[name=delivery_address]').val(delivery.delivery_address);
			$('input[name=delivery_email]').val(delivery.delivery_email);
			$('select#shippingCounty2').val(delivery.delivery_zip_add1);
			get_delivery_zip_add2(delivery.delivery_zip_add1, function(){
				$('select[name=delivery_zip]').val(delivery.delivery_zip);
			});
		})
	}
	pageFun.index = function(){
		var rindex = $("#indexKv >ul li.on").index();
		$('.KvTabContent:eq('+rindex+') .mainKv.flexslider').flexslider({
				animation: "slide"
			});
		var itemW = $(".promoteTabsContent ul li").width(),
		        flexsliders = [];
	    function getGridSize() {
	        return (window.innerWidth < 1023) ? 2 :
	               (window.innerWidth < 1200) ? 2 : 3;
	    }
	    $('.promoteTabsContent').flexslider({
	        animation: "slide",
	        animationLoop: false,
	        slideshow: false,
	        itemWidth: itemW,
	        itemMargin: 0,
	        controlNav: false,
	        minItems: getGridSize(),
	        maxItems: getGridSize(),
	            start: function(slider){
	              flexsliders.push(slider);
	            }
	      });
		$('#PromoteLimitSlider.flexslider').flexslider({
				animation: "slide",
				controlNav: false,
				slideshow: false,
			});
		$("#indexKv >ul li").click(function(){
			var now = $(this).index();
			$("#indexKv >ul li").removeClass("on");
			$(".KvTabContent").removeClass("on");
			$("#indexKv >ul li:eq("+now+")").addClass("on");
			$(".KvTabContent:eq("+now+")").addClass("on");
			if(!$(".KvTabContent:eq("+now+") .flex-viewport").length)
			{
				$('.KvTabContent:eq('+now+') .mainKv.flexslider').flexslider({
						animation: "slide"
					});
			}
		})
		$("#promoteTabs >ul li").click(function(){
		  var now = $(this).index();
		  $("#promoteTabs >ul li").removeClass("on");
		  $(".promoteTabsContent").removeClass("on");
		  $("#promoteTabs >ul li:eq("+now+")").addClass("on");
		  $(".promoteTabsContent:eq("+now+")").addClass("on");
		  var gridSize = getGridSize();
		  if(!$(".promoteTabsContent:eq("+now+") .flex-viewport").length)
		  {
		     $('.promoteTabsContent:eq('+now+')').flexslider({
		        animation: "slide",
		        animationLoop: false,
		        slideshow: false,
		        itemWidth: itemW,
		        itemMargin: 0,
		        controlNav: false,
		        minItems: gridSize,
		        maxItems: gridSize,
		        start: function(slider){
		          flexsliders[now] = slider;
		        }
		      });
		  }
		  else
		  {
		    flexsliders[now].vars.minItems = gridSize;
		    flexsliders[now].vars.maxItems = gridSize;
		    $('.flex-active-slide').resize();
		  }
		});
		$(window).resize(function() {

		    var gridSize = getGridSize();

		    $.each(flexsliders,function(i,el){
		      el.vars.minItems = gridSize;
		      el.vars.maxItems = gridSize;
		    })
	  	});
		//計時器
		if($(".actTime").length)
		{
			$(".actTime").each(function() {
				var finalData = $(this).data("date");
				$(this).find('p')
				.countdown(finalData, function(event) {
					$(this).html(
						event.strftime('<span>%D</span>天<span>%H</span>時<span>%M</span>分<span>%S</span>秒')
					);
				});
			});
			// var finalData = $(".actTime").data("date");
			// $(".actTime p")
			// 	.countdown(finalData, function(event) {
			// 		$(this).html(
			// 			event.strftime('<span>%D</span>天<span>%H</span>時<span>%M</span>分<span>%S</span>秒')
			// 		);
			// 	});
		}
	}
	pageFun.booking = function(){
		var Today = new Date(new Date().getTime() + 86400000);
		$( "#datepicker" ).datepicker({
			dateFormat:"yy/mm/dd",
			minDate: Today.getFullYear() + "/" + (Today.getMonth()+1) + "/" +  Today.getDate()
		});
		// //搜尋門市
		// $("#searchStore").click(function(){
		// 	$("#storeSearchResult").show();
		// });
		// $("#selectStore").change(function(){
		// 	$("#storeSearchResult dl,#storeMap").show();
		// })
		// $("#oftenStores").change(function(){
		// 	$("#storeSearchResult dl,#storeMap,#storeSearchResult").hide();
		// })
		//搜尋門市
		$("#add2_select").change(function(){
			var nTemp_Store_Zip = parseInt($('#add2_select').val());
			var nLimit_Store_Ec = 1;
			// 預約服務頁面 不限定 EC 門市，預約試戴有限定 EC 門市
			if ( $('input[name=experience_name]').length ){
				nLimit_Store_Ec = 0;
			}
			$.ajax({
				type: 'POST',
				url: '/ajax/ajax_search_store.php',
				dataType: 'html',
				data: 'store_zip=' + nTemp_Store_Zip + '&limit_store_ec=' + nLimit_Store_Ec,
				success: function (sMsg){
					if ( sMsg == 'error' )
					{
						alert('系統錯誤，請重新操作。');
					}else{
						sMsg = JSON.parse(sMsg);
						$('#storeSearchResultNum').text('(共' + sMsg.length + '筆)');
						$('#selectStore').empty();
						$('#selectStore').append('<option value="" disabled="" selected="">請選擇門市</option>');
						sMsg.forEach(function(e) {
							$('#selectStore').append('<option value="' + e.store_id + '" data-store=\''+ JSON.stringify(e) + '\'>' + e.store_name + '</option>');
						});
						$("ul.slectStore2 li h4,ul.slectStore2 li:first-child >div >h4 + p").addClass('on');
					}
				},
				error: function (sMsg1, sMsg2){
					alert('系統錯誤！');
				},
			});
		});
		//搜尋門市
		/*$("#searchStore").click(function(){
			var nTemp_Store_Zip = parseInt($('#add2_select').val());
			var nLimit_Store_Ec = 1;
			// 預約服務頁面 不限定 EC 門市，預約試戴有限定 EC 門市
			if ( $('input[name=experience_name]').length ){
				nLimit_Store_Ec = 0;
			}
			$.ajax({
				type: 'POST',
				url: '/ajax/ajax_search_store.php',
				dataType: 'html',
				data: 'store_zip=' + nTemp_Store_Zip + '&limit_store_ec=' + nLimit_Store_Ec,
				success: function (sMsg){
					if ( sMsg == 'error' )
					{
						alert('系統錯誤，請重新操作。');
					}else{
						sMsg = JSON.parse(sMsg);
						$('#storeSearchResultNum').text('(共' + sMsg.length + '筆)');
						$('#selectStore').empty();
						$('#selectStore').append('<option value="" disabled="" selected="">請選擇門市</option>');
						sMsg.forEach(function(e) {
							$('#selectStore').append('<option value="' + e.store_id + '" data-store=\''+ JSON.stringify(e) + '\'>' + e.store_name + '</option>');
						});
					}
				},
				error: function (sMsg1, sMsg2){
					alert('系統錯誤！');
				},
			});
			$("#storeSearchResult").show();
		});*/
		$("#selectStore,#oftenStores").change(function(){
			var store = JSON.parse($(this).find("option:selected").attr('data-store'));
			if($("#storeTab1").is(":checked"))
			{
				$('#storeSearchResult dt >p').hide();
			}
			else
			{
				$('#storeSearchResult dt >p').show();
			}
			$('#storeSearchResultName').text(store.store_name);
			$('#storeSearchResultAddress').text(store.store_address + ' ' + store.store_phone);
			$('#storeSearchResultOpen').text('營業時間 ' + store.store_opentime);
			if(store.store_lat && store.store_lng){
				$('#storeMap iframe').attr('src', 'https://www.google.com/maps/embed/v1/place?key=AIzaSyCT0Nb4KWcWaQoV63tAJar5ATMfdaJF9lY&zoom=18&q=' + store.store_lat + ',' + store.store_lng);
			}else{
				$('#storeMap iframe').attr('src', 'https://www.google.com/maps/embed/v1/place?key=AIzaSyCT0Nb4KWcWaQoV63tAJar5ATMfdaJF9lY&zoom=18&q=' + store.store_address);
			}
			$("input[name=store_id]").val(store.store_id);
			// $("input[name=store_id]").attr('data-store', JSON.stringify(store));
			if (store.store_time_list )
			{
				$('#bookingTime').empty();
				$('#bookingTime').append('<option value="" disabled="" selected="">請選擇時段</option>');
				store.store_time_list.forEach(function(e) {
					$('#bookingTime').append('<option value="' + e.value + '">' + e.name + '</option>');
				});
			}
			$("#storeSearchResult").addClass('on');
		})
		$("input[name=storeTab]").change(function(){
			$("#storeSearchResult").removeClass('on');
			$("#selectStore,#oftenStores").val(null);


		})
		// $("#oftenStores").change(function(){
		// 	// $("#storeSearchResult dl,#storeMap,#storeSearchResult").hide();
		// 	var store = JSON.parse($("#oftenStores option:selected").attr('data-store'));
		// 	// $('#storeSearchResultName').text(store.store_name);
		// 	// $('#storeSearchResultAddress').text(store.store_address + ' ' + store.store_phone);
		// 	// $('#storeSearchResultOpen').text('營業時間 ' + store.store_opentime);
		// 	// $('#storeMap iframe').attr('src', 'https://www.google.com/maps/embed/v1/place?key=AIzaSyCT0Nb4KWcWaQoV63tAJar5ATMfdaJF9lY&q=' + store.store_lat + ',' + store.store_lng);
		// 	// $("#storeSearchResult dl,#storeMap").show();
		// 	$("input[name=store_id]").val(store.store_id);
		// 	// $("input[name=store_id]").attr('data-store', JSON.stringify(store));
		// 	if (store.store_time_list )
		// 	{
		// 		$('#bookingTime').empty();
		// 		$('#bookingTime').append('<option value="" disabled="" selected="">請選擇時段</option>');
		// 		store.store_time_list.forEach(function(e) {
		// 			$('#bookingTime').append('<option value="' + e.value + '">' + e.name + '</option>');
		// 		});
		// 	}
		// })
		//切換預約tab
		// $("#bookingSelect >p a").click(function(){
		// 	var nowi = $(this).index();
		// 	$("#bookingSelect >p a").removeClass("on");
		// 	$("#bookingSelect >p a:eq("+nowi+")").addClass("on");
		// 	$("#bookingSelect >div").hide();
		// 	$("#bookingSelect >div:eq("+nowi+")").show();
		// })
	}
	//條款scroll
	pageFun.terms = function(id){
	  var h = ($(window).width() > 767) ? 100 : 70;
	  $body.stop().animate({
	            scrollTop: $(id).offset().top - h
	          }, 1000);
	}
	//faq function
	pageFun.faq = function(){
	  //切換faqTab
	  $("#faqList >p a").click(function(){
	  	$("#faqList >ul >li").removeClass('on');
	    var nowi = $(this).index();
	    $("#faqList >p a").removeClass("on");
	    $("#faqList >p a:eq("+nowi+")").addClass("on");
	    $("#faqList >ul").removeClass("on");
	    $("#faqList >ul:eq("+nowi+")").addClass("on");
	    location.href="#faq_"+nowi;
	  });
	  $("#faqList >ul >li >a").click(function(){
	  	var $ta = $(this).parent();
	  	if($ta.hasClass('on'))
	  	{
	  		$ta.removeClass('on');
	  	}
	  	else
	  	{
	  		$("#faqList >ul >li").removeClass('on');
			if($ta.hasClass('on'))
			{
				$ta.removeClass('on');
				location.href="#faq_"+$("#faqList >p a.on").index();
			}
			else
			{
				$ta.addClass('on');
				location.href="#faq_"+$("#faqList >p a.on").index()+"_"+$ta.index();
			}
	  	}

	  });
	  $("#hotFaq a").click(function(){
	  	var hashs = $(this).attr("href");
	  	var gqa = hashs.split('_');
	  	pageFun.faq.gotoQ(gqa[1],gqa[2]);
	  })
	  pageFun.faq.gotoQ = function(tabNum,qNum){
	  	 $("#faqList >ul >li").removeClass('on');
	     $("#faqList >p a:eq("+tabNum+")").trigger('click');

	     if(qNum)
	     {
	     	setTimeout(function(){
	     		$("#faqList >ul:eq("+tabNum+") >li:eq("+qNum+")").addClass("on");
	     		$body.stop().animate({scrollTop: $("#faqList >ul:eq("+tabNum+") >li:eq("+qNum+")").offset().top - 77}, 1000);
	     	},500)
	     }
	  }
	  if(location.hash && location.hash.indexOf('faq') != -1)
	  {
	    var gqa = location.hash.split('_');
	    pageFun.faq.gotoQ(gqa[1],gqa[2]);
	  }
	}
	pageFun.stores = function(){
		var apiurl = '/',
				storeData, iconList = ['images/marker.png', 'images/markerS1.png', 'images/markerS2.png', 'images/markerS3.png'];
		$.get(apiurl+'api/get_store.php',function(data){
			if(data.login_status == 0)
			{
				$("#addToOftenAddress").hide();
			}
			storeData = data.store;
			$.each(storeData,function(i,el){
				i = parseInt(i);

				// if(el.store_lat && !iscenter)
				// {
				// 	iscenter+=1;
				// 	var stratCenter = {lat: el.store_lat*1, lng: el.store_lng*1};
				// 	map.setCenter(stratCenter);
				// }

				markers[i] = new google.maps.Marker({
								position: new google.maps.LatLng(el.store_lat, el.store_lng),
								map: map,
								customInfo: i,
								iconType: el.store_icon,
								animation: google.maps.Animation.DROP,
								icon: (iconList[el.store_icon] ? iconList[el.store_icon] : 'images/marker.png')
							});
				markers[i].addListener('click', function() {
						$("#selectStore").val(null);
						changeStore(markers[i]['customInfo']);
					});
			});
			if(getValue('sid'))
			{
				changeStore(getValue('sid'));
			}
		});
		$.get(apiurl+'api/address_1.php',function(data){
			var strHtml = "";
			$.each(data,function(i,el){
				strHtml += '<option value="'+el.add1+'">'+el.name+'</option>'
			});
			$("#county").append(strHtml).on('change',function(){
				if($(this).val() == "")
				{
					$("#district").html('<option value="" selected="">請先選擇縣市</option>');
				}
				else
				{
					$.get(apiurl+'api/address_2.php?add1='+$(this).val(),function(data){
						var strHtml = '<option value="" disabled selected="">請選擇區域</option>';
						$.each(data,function(i,el){
							strHtml += '<option value="'+el.zip+'">'+el.name+'</option>'
						});
						$("#district").html(strHtml).on('change',function(){
							var tempData = [],
									zip = $("#district").val(),
									use = parseInt($('input[name=eyeUse]:checked').val());

							$.each(storeData,function(i,el){
								var match = false;

								// zip
								if(el.store_zip.substr(0, 3) == zip)
								{
									// use
									switch(use)
									{
										case 0:
											match = true;
											break;
										case 1:
											if ( el.store_eye_icon_2 && el.store_eye_icon_3 )
											{
												match = true;
											}
											break;
										case 2:
											if ( el.store_eye_icon_3 )
											{
												match = true;
											}
											break;
									}
								}

								if ( match )
								{
									el.dataNum = i;
									tempData.push(el);
								}
							});
							var strHtml = '<option value="" disabled="" selected="">請選擇門市</option>';
							var iscenter = 0;
							$.each(tempData,function(i,el){
								if(el.store_lat && !iscenter)
								{
									iscenter+=1;
									var stratCenter = {lat: el.store_lat*1, lng: el.store_lng*1};
									map.setCenter(stratCenter);
								}
								strHtml += '<option value="'+el.dataNum+'">'+el.store_name+'</option>';
							});
							$("#selectStore").html(strHtml).show().on('change',function(){
								if($(this).val())
									changeStore(parseInt($(this).val()))
							});
						});

						$("input[name=eyeUse]").on('change', function() {
							$("#district").trigger('change');
						});
					});
				}
			});
		});

		function clearOverlays() {
			for (var i = 0; i < markers.length; i++ ) {
				markers[i].setMap(null);
			}
			markers.length = 0;
		}

		function storeAddFav(sid){

			$.post(apiurl+'api/users_store_add.php',{store_id:sid},function(data){
				if(data.code == 0)
				{
					data.store_used = 1;
					$("#addToOftenAddress").addClass('on').text('移除常用門市').bind('click',function(){
						storeRemoveFav(sid);
					});
				}
			})
		}
		function storeRemoveFav(sid){
			$.post(apiurl+'api/users_store_add.php',{store_id:sid,mode:'del'},function(data){
				if(data.code == 0)
				{
					data.store_used = 0;
					$("#addToOftenAddress").removeClass('on').text('加入常用門市').bind('click',function(){
						storeAddFav(sid);
					});
				}
			})
		}

		function changeStore(i){
			function changeURL(url){
                		window.history.pushState({},0,location.protocol+'//'+window.location.host+location.pathname+url);
         		}
         		changeURL('?sid='+i);

            		var iconList = ['images/marker.png', 'images/markerS1.png', 'images/markerS2.png', 'images/markerS3.png'];
            		var iconFocusList = ['images/marker2.png', 'images/markerS12.png', 'images/markerS22.png', 'images/markerS32.png'];
			var dataTa = storeData[i];
			$(".searchDetail dt span").text(dataTa.store_name);
			$(".searchDetail #orderService").attr('href','/experience.php?sid='+dataTa.store_id);
			$(".searchDetail .storeAdd span").text(dataTa.store_address);
			$(".searchDetail .storeAdd a").attr('href','https://www.google.com.tw/maps/dir//'+dataTa.store_address+'/');
			$(".searchDetail .storeTel span").text(dataTa.store_phone);
			$(".searchDetail .storeTime span").text(dataTa.store_opentime);
			$(".searchDetail .lineid").text(dataTa.store_line);
			$(".searchDetail .lineAddFriend").attr('href','https://line.me/R/ti/p/'+dataTa.store_line);
			// if($(".searchDetail iframe").length)
			// {
			// 	var oldId = $(".searchDetail iframe").attr("data-lineid").replace("@",""),
			// 		newSrc = $(".searchDetail iframe").attr("src").replace(oldId,dataTa.store_line.replace("@",""));
			// 	$(".searchDetail iframe").attr("data-lineid",dataTa.store_line).attr("src",newSrc);
			// }
			// else
			// {
			// 	$(".searchDetail .line-it-button").attr("data-lineid",dataTa.store_line);
			// }

			if ( dataTa.store_eye_icon_1 || dataTa.store_eye_icon_2 || dataTa.store_eye_icon_3 ) {
				$(".searchDetail .storeIcon").show();
				dataTa.store_eye_icon_1 == 1 ? $(".searchDetail .storeIcon .storeIcon1").show() : $(".searchDetail .storeIcon .storeIcon1").hide();
				dataTa.store_eye_icon_2 == 1 ? $(".searchDetail .storeIcon .storeIcon2").show() : $(".searchDetail .storeIcon .storeIcon2").hide();
				dataTa.store_eye_icon_3 == 1 ? $(".searchDetail .storeIcon .storeIcon3").show() : $(".searchDetail .storeIcon .storeIcon3").hide();
			} else {
				$(".searchDetail .storeIcon").hide();
			}

			if(!$(".searchDetail").is(":visible"))
			{
				$(".searchDetail").show();
			}
			if($("#addToOftenAddress").is(":visible"))
			{

				if(!dataTa.store_used)
				{
					$("#addToOftenAddress").removeClass('on').text('加入常用門市')
				}
				else
				{
					$("#addToOftenAddress").addClass('on').text('移除常用門市');
				}
				$("#addToOftenAddress").unbind('click').bind('click',function(){
					$(this).unbind('click');
					(!dataTa.store_used)?storeAddFav(dataTa.store_id):storeRemoveFav(dataTa.store_id);
				});
			}
			$.each(markers, function(i2,el2){
				if ( el2 ) {
					if(el2.customInfo == i)
					{
						markers[i2].setIcon((iconFocusList[el2.iconType] ? iconFocusList[el2.iconType] : 'images/marker2.png'));
					}
					else
					{
						markers[i2].setIcon((iconList[el2.iconType] ? iconList[el2.iconType] : 'images/marker.png'));
					}
				}
			})
			var stratCenter = {lat: dataTa.store_lat*1, lng: dataTa.store_lng*1};
			map.setCenter(stratCenter);

		}
	}
	pageFun.promotion = function(){
		$("#promoProductList >ul >li >div >a").click(function(e){
			if($(this).data("href"))
			{
				$("#productMini iframe").attr("src",$(this).data("href")).load(function(){
					$("#productMini iframe").fadeIn();
				});
				$("#productMini").show();
			}
		});
		$("#productMini a").click(function(){
			$("#productMini").fadeOut(300,function(){
				$("#productMini iframe").attr("src","").hide();
			});
		})
	};
	pageFun.search = function(){
		$("#searchTab >a").click(function(){
			var nowi = $(this).index();
			$("#searchTab >a").removeClass("on");
			$("#searchTab >a:eq("+nowi+")").addClass("on");
			$("#searchContent >div").hide();
			$("#searchContent >div:eq("+nowi+")").show();
		})
	}
	pageFun.catelog = function(){
		$(window).bind('scroll',function () {
			var ct = $('#leftSide #catelog').outerHeight() + $('#leftSide #catelog').offset().top - $(window).height();
			if($(this).scrollTop() > ct)
			{
			 $("#leftSide .search_btn").addClass("ab");
			}
			else
			{
			 $("#leftSide .search_btn").removeClass("ab");
			}
		});
	}
	function init(){
		pageFun.globalFun();
		($("#productMain").length) && pageFun.productDetail();
		($("#shopCart").length) && pageFun.shopCart();
		($("#indexKv").length) && pageFun.index();
		($("#booking").length) && pageFun.booking();
		($("#search").length) && pageFun.search();
		($("#promotion").length) && pageFun.promotion();
		($("#faq").length) && pageFun.faq();
		($("#catelog").length) && pageFun.catelog();
	}
	$(window).load(function() {
		init();
	})
});
var addToCart = function(){
	$("#navShopCart").addClass("addCart");
	setTimeout(function(){
		$("#navShopCart").removeClass("addCart");
	},3000)
}
var map,markers=[],loc,
	flexslider = {
		vars: {}
	};
function initMap() {
	if($("#map").length)
	{
		map = new google.maps.Map(document.getElementById('map'), {
			center: {lat: 25.0630299, lng: 121.6550845},
			zoom: 14
		});
		if (navigator.geolocation) {
				navigator.geolocation.getCurrentPosition(showPosition);
		}
		function showPosition(position) {
				var stratCenter = {lat: position.coords.latitude, lng: position.coords.longitude};
				map.setCenter(stratCenter);
				loc = new google.maps.Marker({
					position: new google.maps.LatLng(position.coords.latitude, position.coords.longitude),
					map: map,
					icon: 'images/loc.png',
				});
		}
		pageFun.stores();
	}
}
function add_favorite(nTemp_Category_Id, nTemp_Product_Id){
	if ( !nTemp_Product_Id ) return;
	// var nTemp_Product_Id	= parseInt($('input[name=product_id]').val());
	// var nTemp_Category_Id	= parseInt($('input[name=category_id]').val());

	var sGet_Value = '';
	sGet_Value += 'product_id=' + nTemp_Product_Id;
	sGet_Value += '&category_id=' + nTemp_Category_Id;
	$.ajax({
		type: 'POST',
		url: '/ajax/ajax_cart_add_favorite.php',
		dataType: 'html',
		data: sGet_Value,
		success: function (sMsg){
			if ( sMsg == 'error' )
			{
				alert('系統錯誤，請重新操作。');
			}else if(sMsg == 'No_login'){
				alert('請先登入會員');
				location.href='/member/login.php';
			}else{
				$('#favor_total').text(sMsg);
				alert('成功加入我的最愛');
			}
		},
		error: function (sMsg1, sMsg2){
			alert('系統錯誤！');
		},
	});
}

function add_cart_direct(nTemp_Category_Id, nTemp_Product_Id){
	if ( !nTemp_Product_Id ) return;

	var sGet_Value = '';
	sGet_Value += 'product_id=' + nTemp_Product_Id;
	sGet_Value += '&category_id=' + nTemp_Category_Id;

	var _this = this;
	$.ajax({
		type: 'POST',
		url: '/ajax/ajax_cart_add.php',
		dataType: 'html',
		data: sGet_Value,
		success: function (sMsg){
			if ( sMsg == 'error' )
			{
				alert('系統錯誤，請重新操作。');
			}
			else if ( sMsg == 'empty' )
			{
				alert('缺貨中');
				add_follow_direct(nTemp_Category_Id, nTemp_Product_Id);
			}
			else
			{
				var result = JSON.parse(sMsg);
				if ( result.msg )
				{
					alert(result.msg);
				}
				else
				{
					/*
					$("#navShopCart").addClass("addCart");
					setTimeout(function(){
						var result = JSON.parse(sMsg);
						for(key in result){
							$('#' + key).html( result[key] );
						}
						$("#navShopCart").removeClass("addCart");
					}, 3000);
					*/

					NewpageFun.newAddToCart();
					setTimeout(function(){
						var result = JSON.parse(sMsg);
						for(key in result){
							$('#' + key).html( result[key] );
						}
					}, 500);
				}
			}
		},
		error: function (sMsg1, sMsg2){
			alert('系統錯誤！');
		},
		complete: function (sMsg1, sMsg2){
			//ajax_cart_num();
		}
	});
}

function add_follow_direct(nTemp_Category_Id, nTemp_Product_Id){
	var sGet_Value = '';
	sGet_Value += 'product_id=' + nTemp_Product_Id;
	sGet_Value += '&category_id=' + nTemp_Category_Id;
	$.ajax({
		type: 'POST',
		url: '/ajax/ajax_cart_add_follow.php',
		dataType: 'html',
		data: sGet_Value,
		success: function (sMsg){
			if ( sMsg == 'error' )
			{
				alert('系統錯誤，請重新操作。');
			}else if(sMsg == 'No_login'){
				// alert('請先登入會員');
				// location.href='/member/login.php';
			}else{
				// $('#favor_total').text(sMsg);
				alert('成功加入貨到通知');
				location.href='/follow.php';
			}
		},
		error: function (sMsg1, sMsg2){
			alert('系統錯誤！');
		},
	});
}
$(window).load(function(){
	$('#loading').fadeOut();
	clearTimeout(loadTime);

	// // 客服套件
	// if ( typeof Temcs === 'function' ) {
	// 	new Temcs({
	// 		domain:  'https://TEChatBot.telexpress.com/TEChatBot-EYESmart',
	// 		type: 'iframe',
	// 		channel:  'DEDBAD4E-C238-46C6-B87E-26A56D00BE05',
	// 		paramterTarget: '#teparameters',
	// 	})
	// }
})